{include file="moban/bone_header"}

<span class="layui layui-btn layui-btn-sm" id="lxfs">联系方式</span>

<form class="layui-form layui-form-pane" lay-filter="first" style="padding: 10px 30px 0 0;">
    <div class="layui-form-item">
        <label class="layui-form-label">模版</label>
        <div class="layui-input-block" >
            {volist name='groupAll' id='vo'}
            <input type="radio" name="question_answer_group_id" lay-filter="question_answer_group_id" value="{$vo['id']}" title="{$vo['title']}" />
            {/volist}
        </div>
    </div>

    <div id="listData"></div>

    <div class="layui-form-item" style="text-align:center;">
        <span class="layui-btn layui-btn-normal layui-btn-sm" id="add" style="width:200px;line-height:40px;height:40px;">添加</span>
    </div>

    <div class="layui-form-item layui-hide">
        <input type="button" lay-submit lay-filter="submit" id="submit" value="确认">
        <input type="button" lay-submit lay-filter="layuiadmin-app-form-edit" id="layuiadmin-app-form-edit" value="取消">
    </div>

</form>

<script>
layui.use(['form','upload'], function () {
    var form = layui.form
        , upload = layui.upload
        , countList = 1 ;


    //监听提交
    form.on('submit(submit)', function (data) {
        var DISABLED = 'layui-btn-disabled';
        $(':button').addClass(DISABLED);
        $(':button').attr('disabled', 'disabled');
        Api.edit(data.field, function (res) {
            if(res.code != 200) {
                $(':button').removeClass(DISABLED);
                $(':button').removeAttr('disabled');
            }
        });
    });

    form.on("radio(question_answer_group_id)", function(data){
        var _val = data.value
        $.post("{:url('question_answer')}?gid="+_val, {}, function (objPost) {
            if(objPost.code == 0){
                $(".question").remove();
                if(objPost.count == 0){
                    layer.msg("模版数据为空")
                }else{
                    var _html = "";
                    $.each(objPost.data, function(i, v){
                        _html += "<div class='question'><div class=\"layui-form-item  group-" + _val + "\">\n" +
                            " <input type='hidden' name='question_answer_group_id[" + countList + "]' value='" + v.question_answer_template_id + "'>  " +
                            " <input type='hidden' name='question_answer[" + countList + "]' value='" + v.id + "'>  " +
                            " <input type='hidden' name='id[" + countList + "]' value='0' >  " +
                            "            <label class=\"layui-form-label\">问题</label>\n" +
                            "            <div class=\"layui-input-inline\" style=\"width:550px;\" >\n" +
                            "                <input type=\"text\" name=\"question["+countList+"]\" class=\"layui-input\" value='" + v.question + "' />\n" +
                            "            </div>\n" +
                            "        </div>\n" +
                            "        <div class=\"layui-form-item\">\n" +
                            "            <label class=\"layui-form-label\">答案</label>\n" +
                            "            <div class=\"layui-input-inline\" style=\"width:550px;\" >\n" +
                            "                <textarea type=\"text\" name=\"answer["+countList+"]\" class=\"layui-textarea\" ></textarea>\n" +
                            "            </div>\n" +
                            "        </div>"+
                            "        <div class=\"layui-form-item\">\n" +
                            "            <div class=\"layui-inline\">\n" +
                            "            <label class=\"layui-form-label\">排序"+countList+"</label>\n" +
                            "            <div class=\"layui-input-inline\"  >\n" +
                            "                <input type=\"text\" name=\"sort["+countList+"]\" class=\"layui-input\" />\n" +
                            "            </div>\n" +
                            "            </div>\n" +
                            "            <div class=\"layui-inline\">\n" +
                            "                <span class=\"layui-btn layui-btn-danger DeleteList\">{:lang('delete')}</span>\n" +
                            "            </div>\n" +
                            "        </div><hr style='background-color: #1E9FFF;height: 1px;' /></div>";
                        countList += 1;
                    })
                    $("#listData").append(_html);
                }
            }
        }, 'json');
    })

    $("#lxfs").on("click", function(){
        UI.openLayer("{:url('question_answer_link_url')}?sid={$sid}", 650, 300, '#submit', "入住须知-联系方式");
    })

    $("#add").on("click", function(){
        var _html = "<div><div class=\"layui-form-item\">\n" +
            " <input type='hidden' name='question_answer_group_id["+countList+"]' value='0'>  " +
            " <input type='hidden' name='question_answer["+countList+"]' value='0'>  " +
            " <input type='hidden' name='id["+countList+"]' value='0'>  " +
            "            <label class=\"layui-form-label\">问题</label>\n" +
            "            <div class=\"layui-input-inline\" style=\"width:550px;\" >\n" +
            "                <input type=\"text\" name=\"question["+countList+"]\" lay-verify=\"required\" class=\"layui-input\" />\n" +
            "            </div>\n" +
            "        </div>\n" +
            "        <div class=\"layui-form-item\">\n" +
            "            <label class=\"layui-form-label\">答案</label>\n" +
            "            <div class=\"layui-input-inline\" style=\"width:550px;\" >\n" +
            "                <textarea type=\"text\" name=\"answer["+countList+"]\" lay-verify=\"required\" class=\"layui-textarea\" ></textarea>\n" +
            "            </div>\n" +
            "        </div>"+
            "        <div class=\"layui-form-item\">\n" +
            "            <div class=\"layui-inline\">\n" +
            "            <label class=\"layui-form-label\">排序</label>\n" +
            "            <div class=\"layui-input-inline\"  >\n" +
            "                <input type=\"text\" name=\"sort["+countList+"]\" class=\"layui-input\" />\n" +
            "            </div>\n" +
            "            </div>\n" +
            "            <div class=\"layui-inline\">\n" +
            "                <span class=\"layui-btn layui-btn-danger DeleteList\">{:lang('delete')}</span>\n" +
            "            </div>\n" +
            "        </div><hr style='background-color: #1E9FFF;height: 1px;' /></div>";
        countList += 1;
        $("#listData").append(_html);
    })

    subject_question_answer("{$sid}" * 1)

    function subject_question_answer(_val)
    {
        $.post("{:url('subject_question_answer')}?sid="+_val, {}, function (objPost) {
            if(objPost.code == 0){
                if(objPost.count == 0){
                }else{
                    var _html = "";
                    $.each(objPost.data, function(i, v){
                        if(v.question_answer_group_id > 0 && v.question_answer >0 ){
                            _html += "<div class='question'><div class=\"layui-form-item  group-" + _val + "\">\n";
                        }else {
                            _html += "<div><div class=\"layui-form-item\">\n";
                        }
                        _html += " <input type='hidden' name='question_answer_group_id["+countList+"]' value='"+v.question_answer_group_id+"'>  " +
                            " <input type='hidden' name='question_answer[" + countList + "]' value='" + v.question_answer + "' >  " +
                            " <input type='hidden' name='id[" + countList + "]' value='" + v.id + "' >  " +
                            "            <label class=\"layui-form-label\">问题</label>\n" +
                            "            <div class=\"layui-input-inline\" style=\"width:550px;\" >\n" +
                            "                <input type=\"text\" name=\"question["+countList+"]\" lay-verify=\"required\" class=\"layui-input\" value='" + v.question + "' />\n" +
                            "            </div>\n" +
                            "        </div>\n" +
                            "        <div class=\"layui-form-item\">\n" +
                            "            <label class=\"layui-form-label\">答案</label>\n" +
                            "            <div class=\"layui-input-inline\" style=\"width:550px;\" >\n" +
                            "                <textarea type=\"text\" name=\"answer[" + countList + "]\" lay-verify=\"required\" class=\"layui-textarea\">" + v.answer + "</textarea>\n" +
                            "            </div>\n" +
                            "        </div>"+
                            "        <div class=\"layui-form-item\">\n" +
                            "            <div class=\"layui-inline\">\n" +
                            "            <label class=\"layui-form-label\">排序</label>\n" +
                            "            <div class=\"layui-input-inline\"  >\n" +
                            "                <input type=\"text\" name=\"sort[" + countList + "]\" class=\"layui-input\" value='" + v.sort + "' />\n" +
                            "            </div>\n" +
                            "            </div>\n" +
                            "            <div class=\"layui-inline\">\n" +
                            "                <span class=\"layui-btn layui-btn-danger DeleteList\">{:lang('delete')}</span>\n" +
                            "            </div>\n" +
                            "        </div><hr style='background-color: #1E9FFF;height: 1px;' /></div>";
                        countList += 1;
                    })
                    $("#listData").append(_html);
                }
            }
        }, 'json');
    }

    $("form").on("click", ".DeleteList", function(){
        var _this = $(this);
        _this.parent().parent().parent('div').remove();
    })

});
</script>
