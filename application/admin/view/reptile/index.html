{include file="moban/bone_header"}

<table class="layui-hide" id="think-table" lay-filter="think-table"></table>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">删除</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
</script>

<script>
layui.use(['table','dropdown'], function(){
    var table = layui.table
        ,dropdown = layui.dropdown;

    UI.getPageTable(table, "{:url('')}", [
        {field: 'id', title: '', width:80, fixed: 'left'}
        ,{field: 'type', title: '分类', width:120, templet: function(d){
            switch (d.type * 1) {
                {volist name="type" id="vo" key="k"}
                case {$k}: return "{$vo}";
                {/volist}
                default: return '-';
            }
        }}
        ,{field: 'attribute', title: '属性', width:120, templet: function(d){
            switch (d.attribute * 1) {
                {volist name="attribute" id="vo" key="k"}
                case {$k}: return "{$vo}";
                {/volist}
                default: return '-';
            }
        } }
        ,{field: 'source', title: '来源', width:120,}
        ,{field: 'link', title: '链接', width:300}
        ,{field: 'total', title: '数量', width:90}
        // ,{fixed: 'right',title:'操作', width:240, align:'center', toolbar: '#barDemo'}
    ], "#think-table", 'auth');

    table.on('tool(think-table)', function(obj){
        var data = obj.data;
        if(obj.event==="edit") {
            UI.openLayer("{:url('edit_plate')}?id="+data['id'], 650, 500, '#submit', "{:lang('edit')}");
        }else if(obj.event == 'resource'){
            UI.openLayer("{:url('plate_resource')}?pid="+data['id'], 650, 350, '#submit', "板块资源");
        }else if(obj.event == 'del'){
            layer.confirm('是否删除?', {icon: 3, title:'提示'}, function(index){
                $.post("{:url('del_plate')}?id="+ data['id'], function(obj2){
                    if(obj2.code == 200) {
                        layer.msg(obj2['msg'], {icon: 1}, function(){
                            layer.close(index);
                            obj.del();
                        });
                    }else {
                        layer.msg(obj2['msg']);
                    }

                }, 'json');
            })
        }
    });

    var $ = layui.$, active = {
        create:function(){
            UI.openLayer("{:url('create_plate')}", 650, 500, '#submit', "{:lang('create')}");
        }
    };

    $('.layui-btn-container .layui-btn').on('click', function(){
        var type = $(this).data('type');
        active[type] ? active[type].call(this) : '';
    });

});
</script>
{include file="moban/bone_footer"}