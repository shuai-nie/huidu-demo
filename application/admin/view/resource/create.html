{include file="moban/css"}
{include file="moban/js"}


<form class="layui-form" lay-filter="first" style="padding: 20px 30px 0 0;">
    <div class="layui-form-item">
        <label class="layui-form-label">用户ID</label>
        <div class="layui-input-block">
            <input type="text" name="uid" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">标题</label>
        <div class="layui-input-block">
            <input type="text" name="title" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">类型</label>
        <div class="layui-input-block">
            <input type="radio" name="ty" value="1" title="我提供" checked>
            <input type="radio" name="ty" value="2" title="我需要">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">业务类型</label>
        <div class="layui-input-block">
            {volist name='resourcesType' id='vo'}
            <input type="checkbox" name="type[{$vo['data_no']}]" value="{$vo['data_no']}" title="{$vo['data_name']}">
            {/volist}
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">合作区域</label>
        <div class="layui-input-block">
            {volist name='resourcesRegion' id='vo'}
            <input type="checkbox" name="subdivide[{$vo['data_no']}]" value="{$vo['data_no']}" title="{$vo['data_name']}">
            {/volist}
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">业务细分</label>
        <div class="layui-input-block">
            {volist name='BusinessSubdivide' id='vo'}
            <input type="checkbox" name="region[{$vo['data_no']}]" value="{$vo['data_no']}" title="{$vo['data_name']}">
            {/volist}
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">描述</label>
        <div class="layui-input-block">
            <script id="container" name="intro" type="text/plain"></script>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label"></label>
        <div class="layui-upload">
            <button type="button" class="layui-btn" id="test2">多图片上传</button>
            <blockquote class="layui-elem-quote layui-quote-nm" style="margin: 10px;margin-left:30px;">
                预览图：
                <div class="layui-upload-list" id="demo2"></div>
                <div style="clear:both;"></div>
            </blockquote>
        </div>
    </div>

    <div class="contactName" contactNameLength="0" style="border-bottom:1px solid #e6e6e6;border-top:1px solid #e6e6e6;padding-top:10px;">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label" style="" >联系人</label>
                <div class="layui-input-inline">
                    <input type="text" name="contactName[]" required lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" >
                </div>
            </div>
            <div class="layui-inline">
                <button type="button" class="layui-btn contactNameAdd "><i class="layui-icon layui-icon-add-1"></i></button>
            </div>
        </div>

        <div class="layui-form-item contact">
            <div class="layui-inline">
                <label class="layui-form-label" style="" >联系方式</label>
                <div class="layui-input-inline">
                    <select name="contact[][]" lay-filter="aihao" required lay-verify="required" >
                        <option value="" >请选择</option>
                        {volist name="DataDicData" id="vo"}
                        <option value="{$vo['data_no']}" >{$vo['data_name']}</option>
                        {/volist}
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <div class="layui-input-inline">
                    <input type="text" name="tel[][]" required lay-verify="required" value="" placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <button type="button" class="layui-btn contact-add "  ><i class="layui-icon layui-icon-add-1"></i></button>
            </div>
        </div>
    </div>

    <div class="layui-form-item" style="padding-top:10px;">
        <label class="layui-form-label">反馈信息</label>
        <div class="layui-input-block">
            <input type="text" name="feedback" placeholder="" autocomplete="off" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">置顶开始时间</label>
        <div class="layui-input-block">
            <input type="text" name="top_start_time" id="top_start_time" placeholder="" autocomplete="off" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">置顶结束时间</label>
        <div class="layui-input-block">
            <input type="text" name="top_end_time" id="top_end_time" placeholder="" autocomplete="off" class="layui-input">
            <!--<div class="layui-form-mid layui-word-aux">跳转链接/资源ID</div>-->
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">审核状态</label>
        <div class="layui-input-block">
            <input type="radio" name="auth" value="1" title="通过" checked >
            <input type="radio" name="auth" value="2" title="审核中">
            <input type="radio" name="auth" value="3" title="未通过">
            <input type="radio" name="auth" value="4" title="草稿">
            <input type="radio" name="auth" value="5" title="已关闭">
        </div>
    </div>

    <div class="layui-form-item layui-hide">
        <input type="button" lay-submit lay-filter="submit" id="submit" value="确认">
        <input type="button" lay-submit lay-filter="layuiadmin-app-form-edit" id="layuiadmin-app-form-edit" value="取消">
    </div>

    <!-- <div class="layui-form-item">
      <div class="layui-input-block">
        <button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
      </div>
    </div> -->
</form>
<!--</div>-->

<script type="text/javascript" src="/static/ueditor1433/ueditor.config.js"></script>
<script type="text/javascript" src="/static/ueditor1433/ueditor.all.js"></script>
<script type="text/javascript" src="/static/ueditor1433/ueditor.parse.js"></script>
<script type="text/javascript" src="/static/ueditor1433/lang/zh-cn/zh-cn.js"></script>

<script>
    //Demo
    layui.use(['form','upload','laydate'], function () {
        var form = layui.form,
            upload = layui.upload,
            laydate = layui.laydate;

        var ue = UE.getEditor('container', {
            initialFrameHeight:400,
            autoHeightEnabled:false,
            autoFloatEnabled:false,
            zIndex:"0"
        });

        laydate.render({elem: '#top_start_time',type: 'datetime'});
        laydate.render({elem: '#top_end_time',type: 'datetime'});

        var upload_url = "{:url('admin/Upload/upload')}";
        var upload_accept='images';
        var upload_acceptMime='image/*';
        var upload_size=3145728;
        var imgKey = 0 + "";
        var uploadInst = upload.render({
            elem: '#test2'
            ,url: upload_url
            ,accept: upload_accept
            ,acceptMime:upload_acceptMime
            ,size: upload_size
            ,done: function(res){
                if(res.code == 0) {
                    $('#demo2').append('<div style="width:100px;float:left;position:relative;margin:10px;">'
                        +'<i class="layui-icon layui-icon-close img-delete" style="color:red;border:1px solid red;position:absolute;right:0px;top:-20px;" ></i>'
                        +'<img width="100" height="100" src="'+ res.url +'"  class="layui-upload-img">'
                        + '<input type="hidden" name="img['+imgKey+']" value="'+res.url+'" />'
                        +'</div>');
                    imgKey++;

                } else {
                    layui.msg('网络问题稍后再试');
                }

            }
            ,error: function(){
                //请求异常回调
            }
        });

        $("#demo2").on('click', '.img-delete', function(){
            var _this = $(this);
            _this.parent().remove();
        })

        //监听提交
        form.on('submit(submit)', function (data) {
            data.field.intro = ue.getContent();
            Api.add(data.field, function (res) {
                console.log(res);
                if(res.code == 200) {
                    layer.msg(res.msg, {icon:1,offset: ['100px', '50px'],time: 50000});
                } else {
                    layer.msg(res.msg, {icon:5,offset: ['100px', '50px'],time: 50000});
                }
            });
        });


        $(".layui-form").on("click", ".contactNameAdd", function(){
            var _this = $(this);
            var contactName = _this.parent().parent().parent().parent().children('.contactName').length;
            var contactLength = 0;//_this.parent().parent().parent().children('.contactName').length;
            var _html = '<div class="contactName" contactNameLength="'+contactName+'" style="border-bottom:1px solid #e6e6e6;border-top:1px solid #e6e6e6;padding-top:10px;">'+
                '<div class="layui-form-item">'+
                '    <div class="layui-inline">'+
                '        <label class="layui-form-label" style="">联系人</label>'+
                '        <div class="layui-input-inline">'+
                '            <input type="text" name="contactName['+contactName+']" placeholder="请输入" autoComplete="off" class="layui-input">'+
                '        </div>'+
                '    </div>'+
                '    <div class="layui-inline">'+
                '        <button type="button" class="layui-btn contactNameAdd "><i class="layui-icon layui-icon-add-1"></i></button>'+
                '        <button type="button" class="layui-btn contactNameDel layui-btn-danger"><i class="layui-icon layui-icon-delete"></i></button>'+
                '    </div>'+
                '</div>'+
                '<div class="layui-form-item contact ">\n' +
                '                    <div class="layui-inline">\n' +
                '                        <label class="layui-form-label" style="">联系方式</label>\n' +
                '                        <div class="layui-input-inline">\n' +
                '                            <select name="contact['+contactName+']['+contactLength+']" lay-filter="aihao">\n' +
                ' <option value="" >请选择</option>'+
                {volist name="DataDicData" id="vo"}
                    ' <option value="{$vo['data_no']}" >{$vo['data_name']}</option>'+
                {/volist}
                '                            </select>' +
                '                        </div>\n' +
                '                    </div>\n' +
                '                    <div class="layui-inline">\n' +
                '                        <div class="layui-input-inline">\n' +
                '                            <input type="text" name="tel['+contactName+']['+contactLength+']" placeholder="" autocomplete="off" class="layui-input">\n' +
                '                        </div>\n' +
                '                    </div>\n' +
                '                    <div class="layui-inline">\n' +
                '                        <button type="button" class="layui-btn contactDel layui-btn-danger"><i class="layui-icon layui-icon-delete"></i></button>' +
                '                        <button type="button" class="layui-btn contact-add "><i class="layui-icon layui-icon-add-1"></i></button>' +
                '                    </div>' +
                '                </div>'+
                '</div>';
            _this.parent().parent().parent().after(_html);
            form.render();
        })

        $(".layui-form").on('click', '.contact-add', function(){
            var _this = $(this);
            var contactLength = _this.parent().parent().parent().children('.contact').length;
            var contactName = _this.parent().parent().parent().attr('contactNameLength');

            var _html = '<div class="layui-form-item contact ">\n' +
                '                    <div class="layui-inline">\n' +
                '                        <label class="layui-form-label" style="">联系方式</label>\n' +
                '                        <div class="layui-input-inline">\n' +
                '                            <select name="contact['+contactName+']['+contactLength+']" lay-filter="aihao">\n' +
                ' <option value="" >请选择</option>'+
                {volist name="DataDicData" id="vo"}
                ' <option value="{$vo['data_no']}" >{$vo['data_name']}</option>'+
                {/volist}
                '                                </select>\n' +
                '                        </div>\n' +
                '                    </div>\n' +
                '                    <div class="layui-inline">\n' +
                '                        <div class="layui-input-inline">\n' +
                '                            <input type="text" name="tel['+contactName+']['+contactLength+']" placeholder="" autocomplete="off" class="layui-input">\n' +
                '                        </div>\n' +
                '                    </div>\n' +
                '                    <div class="layui-inline">\n' +
                '                        <button type="button" class="layui-btn contactDel layui-btn-danger"><i class="layui-icon layui-icon-delete"></i></button>' +
                '                        <button type="button" class="layui-btn contact-add "><i class="layui-icon layui-icon-add-1"></i></button>\n' +
                '\n' +
                '                    </div>\n' +
                '\n' +
                '                </div>';
            _this.parent().parent().after(_html);
            form.render();
        })

        $(".layui-form").on("click", ".contactNameDel", function(){
            var _this = $(this);
            _this.parent().parent().parent().remove();
        })

        $(".layui-form").on("click", ".contactDel", function(){
            var _this = $(this);
            _this.parent().parent().remove();
        })


    });
</script>
