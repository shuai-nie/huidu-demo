{include file="moban/css"}
{include file="moban/js"}

<form class="layui-form" lay-filter="first" style="padding: 20px 30px;">
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">账号</label>
            <div class="layui-input-inline"  >
                <input type="text" name="username" disabled value="{$cardInfo['username']}" class="layui-input" style="background-color:#eee;" />
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label" >名称</label>
            <div class="layui-input-inline">
                <input type="text" autocomplete="off" class="layui-input" value="{$cardInfo['name']}" style="background-color:#eee;">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label" style="width:30px;">职位</label>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" name="position" value="{$cardInfo['position']}" style="background-color:#eee;" >
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label" >公司</label>
            <div class="layui-input-inline">
                <select name="firm_relevance" lay-search="" >
                    <option value="">请选择</option>
                    {volist name='firmAll' id='vo'}
                    <option value="{$vo['id']}">{$vo['name']}</option>
                    {/volist}
                </select>
            </div>
        </div>

        <div class="layui-inline layui-hide">
            <label class="layui-form-label" >审核状态</label>
            <div class="layui-input-block">
                <input type="radio" name="relevance_status" value="0" title="未认证" checked />
                <input type="radio" name="relevance_status" value="1" title="已认证" />
            </div>
        </div>

    </div>

    <fieldset class="layui-elem-field">
        <legend>业务需求</legend>
        <div id="yexuxuqiu">
            <div style="margin: 10px 10px 10px 10px">
                {if condition="$userDemandAll"}
                {volist name="userDemandAll" id='vo' key='k'}
                <div class="layui-form-item" style="border-bottom: 1px solid red;">
                    <input type="hidden" name="demand_id[{$k}]" value="{$vo['id']}">
                    <div class="layui-form-item">
                        <label class="layui-form-label" style="width:90px;">期望业务分类</label>
                        <div class="layui-input-block" style="margin-left: 120px;" >
                            {volist name='RESOURCES_TYPE' id='vo'}
                            <input type="radio" name="demand_business_type[{$k}]" value="{$vo['data_no']}" title="{$vo['data_name']}" />
                            {/volist}
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label" style="width: 90px;">期望业务地区</label>
                        <div class="layui-input-block" style="margin-left: 10px;">
                            <input type="checkbox" name="demand_industry[{$k}][|]" lay-key="{$k}" value="|" lay-filter="demand_industry" title="不限" />

                            {volist name='RESOURCES_REGION' id='vo'}
                            <input type="checkbox" name="demand_industry[{$k}][{$vo['data_no']}]" lay-key="{$k}" value="{$vo['data_no']}" lay-filter="demand_industry" title="{$vo['data_name']}" />
                            {/volist}
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label" style="width:90px;">期望合作行业</label>
                        <div class="layui-input-block" style="margin-left:10px;">
                            <input type="checkbox" name="demand_region[{$k}][|]" lay-key="{$k}" lay-filter="demand_region" value="|" title="不限" />
                            {volist name='ADVERT_ATTRIBUTE' id='vo'}
                            <input type="checkbox" name="demand_region[{$k}][{$vo['data_no']}]" lay-key="{$k}" lay-filter="demand_region" value="{$vo['data_no']}" title="{$vo['data_name']}" />
                            {/volist}
                        </div>
                    </div>
                    {if condition="$k gt 1"}
                    <span class="layui-btn layui-btn-sm layui-btn-danger deleteYwxq" style="margin: 0 0 10px 10px;">删除</span>
                    {/if}

                </div>
                {/volist}
                {else}
                <div class="layui-form-item" style="border-bottom: 1px solid red;">
                    <div class="layui-form-item">
                        <label class="layui-form-label" style="width:90px;">期望业务分类</label>
                        <div class="layui-input-block" style="margin-left: 120px;" >
                            {volist name='RESOURCES_TYPE' id='vo'}
                            <input type="radio" name="demand_business_type[0]" value="{$vo['data_no']}" title="{$vo['data_name']}" />
                            {/volist}
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label" style="width: 90px;">期望业务地区</label>
                        <div class="layui-input-block" style="margin-left: 10px;">
                            <input type="checkbox" name="demand_industry[0][|]" lay-key="0" value="|" lay-filter="demand_industry" title="不限" />

                            {volist name='RESOURCES_REGION' id='vo'}
                            <input type="checkbox" name="demand_industry[0][{$vo['data_no']}]" lay-key="0" value="{$vo['data_no']}" lay-filter="demand_industry" title="{$vo['data_name']}" />
                            {/volist}
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label" style="width:90px;">期望合作行业</label>
                        <div class="layui-input-block" style="margin-left:10px;">
                            <input type="checkbox" name="demand_region[0][|]" lay-key="0" lay-filter="demand_region" value="|" title="不限" />
                            {volist name='ADVERT_ATTRIBUTE' id='vo'}
                            <input type="checkbox" name="demand_region[0][{$vo['data_no']}]" lay-key="0" lay-filter="demand_region" value="{$vo['data_no']}" title="{$vo['data_name']}" />
                            {/volist}
                        </div>
                    </div>

                    <!--<span class="layui-btn layui-btn-sm layui-btn-danger deleteYwxq" style="margin: 0 0 10px 10px;">删除</span>-->

                </div>
                {/if}

            </div>
        </div>
        <span class="layui-btn layui-btn-sm" style="margin: 0 0 10px 10px;" id="addYwxq">增加</span>
    </fieldset>

    <div class="layui-form-item layui-hide">
        <input type="button" lay-submit lay-filter="submit" id="submit" value="确认">
        <input type="button" lay-submit lay-filter="layuiadmin-app-form-edit" id="layuiadmin-app-form-edit" value="取消">
    </div>

</form>

<script>
    layui.use(['form'], function () {
        var form = layui.form;

        form.on('submit(submit)', function (data) {
            var DISABLED = 'layui-btn-disabled';
            $(':button').addClass(DISABLED);
            $(':button').attr('disabled', 'disabled');
            Api.add(data.field, function (res) {
                if(res.code == 400){
                    layer.msg(res.msg)
                }else{
                    layer.msg(res.msg, {icon:1, offset: ['150px', '150px']})
                }
                $(':button').removeClass(DISABLED);
                $(':button').removeAttr('disabled');
            });
        });

        let _addYwxqCount = 1+{$userDemandAll|count};
        $("#addYwxq").on('click', function(){
            if (_addYwxqCount > 5) {
                layer.msg('业务需求只能添加五个', {offset: ['200px', '100px']})
                return false
            }
            _addYwxqCount++
            var _this = $(this)
            var _html = "<div class=\"layui-form-item\" style=\"border-bottom: 1px solid red;\">\n" +
                "                <div class=\"layui-form-item\">\n" +
                "                    <label class=\"layui-form-label\" style=\"width:90px;\">期望业务分类</label>\n" +
                "                    <div class=\"layui-input-block\" style=\"margin-left: 120px;\" >\n" +
                {volist name='RESOURCES_TYPE' id='vo'}
            "<input type=\"radio\" name=\"demand_business_type["+_addYwxqCount+"]\" lay-key='"+_addYwxqCount+"' value=\"{$vo['data_no']}\" title=\"{$vo['data_name']}\" />" +
            {/volist}
            "                    </div>\n" +
            "                </div>\n" +
            "\n" +
            "                <div class=\"layui-form-item\">\n" +
            "                    <label class=\"layui-form-label\" style=\"width: 90px;\">期望业务地区</label>\n" +
            "                    <div class=\"layui-input-block\" style=\"margin-left: 10px;\">\n" +
            "                        <input type=\"checkbox\" lay-key='"+_addYwxqCount+"' name=\"demand_industry["+_addYwxqCount+"][|]\" value=\"|\" title=\"不限\" />\n" +
            {volist name='RESOURCES_REGION' id='vo'}
            "                        <input type=\"checkbox\" lay-key='"+_addYwxqCount+"' name=\"demand_industry["+_addYwxqCount+"][{$vo['data_no']}]\" value=\"{$vo['data_no']}\" lay-filter=\"demand_industry\" title=\"{$vo['data_name']}\" />\n" +
            {/volist}
            "                    </div>\n" +
            "                </div>\n" +
            "\n" +
            "                <div class=\"layui-form-item\">\n" +
            "                    <label class=\"layui-form-label\" style=\"width:90px;\">期望合作行业</label>\n" +
            "                    <div class=\"layui-input-block\" style=\"margin-left:10px;\">\n" +
            "                        <input type=\"checkbox\" lay-key='"+_addYwxqCount+"' name=\"demand_region["+_addYwxqCount+"][|]\" lay-filter=\"demand_region\" value=\"|\" title=\"不限\" />\n" +

            {volist name='ADVERT_ATTRIBUTE' id='vo'}
            "<input type=\"checkbox\" lay-key='"+_addYwxqCount+"' name=\"demand_region["+_addYwxqCount+"][{$vo['data_no']}]\" lay-filter=\"demand_region\" value=\"{$vo['data_no']}\" title=\"{$vo['data_name']}\" />\n" +
            {/volist}
            "                    </div>\n" +
            "                </div>\n" +
            "<span class=\"layui-btn layui-btn-sm layui-btn-danger deleteYwxq\" style=\"margin: 0 0 10px 10px;\">删除</span>\n" +
            "            </div>";

            _this.prev().children(':first-child').append(_html)
            form.render();

        })

        $("#yexuxuqiu").on('click', ".deleteYwxq", function(){
            let _this = $(this)
            _addYwxqCount--;
            _this.parent().remove()
        })

        form.on('checkbox(demand_industry)', function(data){
            let _val = data.value
                , _this = $(this)
                , _key = _this.attr('lay-key');

            console.log(_val)
            console.log(_key)

            if(_val == '|'){
                if(_key == 1){
                    form.val("first", {
                    {volist name='RESOURCES_REGION' id='vo'}
                    "demand_industry[1][{$vo['data_no']}]": false,
                        {/volist}
                });
                }

                if(_key == 2){
                    form.val("first", {
                    {volist name='RESOURCES_REGION' id='vo'}
                    "demand_industry[2][{$vo['data_no']}]": false,
                        {/volist}
                });
                }

                if(_key == 3){
                    form.val("first", {
                    {volist name='RESOURCES_REGION' id='vo'}
                    "demand_industry[3][{$vo['data_no']}]": false,
                        {/volist}
                });
                }

                if(_key == 4){
                    form.val("first", {
                    {volist name='RESOURCES_REGION' id='vo'}
                    "demand_industry[4][{$vo['data_no']}]": false,
                        {/volist}
                });
                }

                if(_key == 5){
                    form.val("first", {
                    {volist name='RESOURCES_REGION' id='vo'}
                    "demand_industry[5][{$vo['data_no']}]": false,
                        {/volist}
                });
                }
            }else{
                if(_key == 1){form.val("first", {"demand_industry[1][|]": false})}
                if(_key == 2){form.val("first", {"demand_industry[2][|]": false})}
                if(_key == 3){form.val("first", {"demand_industry[3][|]": false})}
                if(_key == 4){form.val("first", {"demand_industry[4][|]": false})}
                if(_key == 5){form.val("first", {"demand_industry[4][|]": false})}
            }
        })

        form.on('checkbox(demand_region)', function(data){
            let _val = data.value
                , _this = $(this)
                , _key = _this.attr('lay-key');
            if(_val == '|'){
                if(_key == 0){
                    form.val("first", {
                    {volist name='ADVERT_ATTRIBUTE' id='vo'}
                    "demand_region[0][{$vo['data_no']}]": false,
                        {/volist}
                });
                }
                if(_key == 1){
                    form.val("first", {
                    {volist name='ADVERT_ATTRIBUTE' id='vo'}
                    "demand_region[1][{$vo['data_no']}]": false,
                        {/volist}
                });
                }

                if(_key == 2){
                    form.val("first", {
                    {volist name='ADVERT_ATTRIBUTE' id='vo'}
                    "demand_region[2][{$vo['data_no']}]": false,
                        {/volist}
                });
                }

                if(_key == 3){
                    form.val("first", {
                    {volist name='ADVERT_ATTRIBUTE' id='vo'}
                    "demand_region[3][{$vo['data_no']}]": false,
                        {/volist}
                });
                }

                if(_key == 4){
                    form.val("first", {
                    {volist name='ADVERT_ATTRIBUTE' id='vo'}
                    "demand_region[4][{$vo['data_no']}]": false,
                        {/volist}
                });
                }
            }else{
                if(_key == 0){form.val("first", {"demand_region[0][|]": false})}
                if(_key == 1){form.val("first", {"demand_region[1][|]": false})}
                if(_key == 2){form.val("first", {"demand_region[2][|]": false})}
                if(_key == 3){form.val("first", {"demand_region[3][|]": false})}
                if(_key == 4){form.val("first", {"demand_region[4][|]": false})}
            }
        })

        form.val("first", {
            "firm_relevance": "{$cardInfo['firm_id']|default=''}",
        {volist name="userDemandAll" id='vo' key='k'}
            "demand_business_type[{$k}]": "{$vo['business_type']}",

            {if condition="$vo['industry'] eq '|'"}
                "demand_industry[{$k}][|]":true,
            {else}
            {volist name="vo['industry']" id='vo_in'}
            "demand_industry[{$k}][{$vo_in}]":true,
            {/volist}
            {/if}

            {if condition="$vo['region'] eq '|'"}
            "demand_region[{$k}][|]":true,
            {else}
            {volist name="vo['region']" id='vo_ty'}
            "demand_region[{$k}][{$vo_ty}]":true,
            {/volist}
            {/if}

        {/volist}

        })






    });
</script>
